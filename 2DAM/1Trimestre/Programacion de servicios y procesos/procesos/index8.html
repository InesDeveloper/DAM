<html>
    <head>
    </head>
    <body>
        <canvas id="lienzo" width=512px height=512px></canvas>
        <script>
            var numerotrabajadores = 50;                                        //Define el numero de trabajadores
            var trabajadores = new Array();                                     //Los trabajadores son una nueva colección donde cada uno pone un Worker
            var personajes = new Array();
            var contexto = document.getElementById("lienzo").getContext("2d")   //Especifico un contexto en el que voy a dibujar
            var temporalizador;                                                 //Creo un nuevo temporalizador vacío
            for(var i = 0;i<numerotrabajadores;i++){                            //Para cada uno de los trabajadores
                trabajadores[i] = new Worker("tarea8.js");                      //dentro de la colección les asigno un trabajador
                trabajadores[i].postMessage({id:i})
                personajes[i] = {x:0,y:0,r:0,g:0,b:0,otros:0,id:i}
                trabajadores[i].onmessage = function(datos){
                    personajes[datos.data.id].x = datos.data.x 
                    personajes[datos.data.id].y = datos.data.y
                    personajes[datos.data.id].r = datos.data.mir
                    personajes[datos.data.id].g = datos.data.mig
                    personajes[datos.data.id].b = datos.data.mib
                    personajes[datos.data.id].tam = datos.data.tam
                    
                }   
            }
            inicio();                                                           //Llama a la funcion de inicio
            function inicio(){                                                  //Define la funcion de inicio
                temporalizador = setTimeout("bucle()",1000)                     //Dentro de un segundo ejecutamos la funcion bucle
            }
            function bucle(){                                                   //Define la funcion del bucle
                contexto.fillStyle = "rgba(255,255,255,0.1)"                    
                contexto.fillRect(0,0,512,512)
                for(var i = 0;i<numerotrabajadores;i++){
                    contexto.fillStyle = "rgb("+personajes[i].r+","+personajes[i].g+","+personajes[i].b+")"
//                    contexto.fillRect(personajes[i].x,personajes[i].y,personajes[i].tam,personajes[i].tam) // Dibuja un rectangulo
                    contexto.beginPath();                                                                           // Crea un path para dibujar una figura
                    contexto.arc(personajes[i].x,personajes[i].y,personajes[i].tam,personajes[i].tam,2*Math.PI+personajes[i].tam);    // Pinta un circulo
                    contexto.fill();                                            // Rellena la figura con un color
                    contexto.stroke();                                          // Dibuja el path, pinta el borde
                    trabajadores[i].postMessage({id:i,otros:personajes})
                }
                
                clearTimeout(temporalizador)                                    //Elimino el temporizador anterior para refrescarlo
                temporalizador = setTimeout("bucle()",33)                       //Creo un nuevo temporizador recursivo que se llama a si mismo
            }           
        </script>
    
    </body>
</html>